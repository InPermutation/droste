<!doctype html>
<html>
<head>
    <title>Droste builder</title>
    <link rel="stylesheet" href="static/bootstrap/css/bootstrap.min.css" media="screen" />
    <script src="static/jquery-1.8.3.min.js"></script>
</head>
<body>
    <h1>Droste</h1>
    <form method="post" enctype="multipart/form-data" id="drosteForm">
        <input type="file" name="file" id="file1" />
        <input type="number" name="x1" id="x1" />
        <input type="number" name="y1" id="y1" />
        <input type="number" name="x2" id="x2" />
        <input type="number" name="y2" id="y2" />
        <input type="submit" name="submit" id="submit" value="Recurse" />
        <div id='editor'></div>
    </form>
    <script>
        (function($) {
            var step = 1;
            function clicked(e) {
                $("#x"+step).val(e.pageX - this.offsetLeft);
                $("#y"+step).val(e.pageY - this.offsetTop);
                step = step==1 ? 2 : 1;
            }
            function editor() {
                $("#editor").empty();

                var files = $("#file1")[0].files;
                if (!files) return;
                var file = files[0];
                if (!file) return;
                var reader = new FileReader;
                reader.onload = function (e) {
                    if (!e) return;
                    $("#editor").append(
                        $("<img id='bldImg'>")
                            .attr("src", e.target.result)
                            .click(clicked)
                    );
                };
                reader.readAsDataURL(file);
            }
            $("#file1").change(editor);
            $(editor);
        })(window.jQuery);
    </script>
</body>
</html>
